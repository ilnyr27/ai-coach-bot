# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É RAG-–±–æ—Ç–∞ —Å –ª–∏—á–Ω–æ—Å—Ç—å—é –î–∂–µ–π–º—Å–∞ –ö–ª–∏—Ä–∞

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è AI-–∫–æ—É—á–∞ —Å –ª–∏—á–Ω–æ—Å—Ç—å—é –î–∂–µ–π–º—Å–∞ –ö–ª–∏—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–Ω–∏–≥–∏ "–ê—Ç–æ–º–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏" —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RAG (Retrieval-Augmented Generation).

## üìã –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
‚úÖ EPUB –ø–∞—Ä—Å–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∫–Ω–∏–≥–∏
‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–±–∏–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ chunks (800 —Å–∏–º–≤–æ–ª–æ–≤ —Å overlap 200)
‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings —á–µ—Ä–µ–∑ sentence-transformers
‚úÖ –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î ChromaDB –¥–ª—è –ø–æ–∏—Å–∫–∞
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DeepSeek API
‚úÖ Telegram –±–æ—Ç —Å RAG-—Å–∏—Å—Ç–µ–º–æ–π

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
python -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–∫–µ—Ç—ã
pip install -r requirements.txt
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –∫–ª—é—á–∏:
```

```env
# DeepSeek API Key (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ https://platform.deepseek.com)
DEEPSEEK_API_KEY=your_deepseek_api_key_here

# Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
```

### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–Ω–∏–≥—É –≤ RAG —Å–∏—Å—Ç–µ–º—É

–ö–Ω–∏–≥–∞ —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `data/books/`. –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –µ—ë –∏ —Å–æ–∑–¥–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î:

```bash
python scripts/ingest_book.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. –ü–∞—Ä—Å–∏—Ç EPUB —Ñ–∞–π–ª
2. –†–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ chunks (~800 —Å–∏–º–≤–æ–ª–æ–≤)
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç embeddings –¥–ª—è –∫–∞–∂–¥–æ–≥–æ chunk
4. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ ChromaDB

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5-10 –º–∏–Ω—É—Ç (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –∫–Ω–∏–≥–∏ –∏ –≤–∞—à–µ–≥–æ CPU)

–í—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å:
```
[1/5] üìñ Parsing EPUB...
‚úÖ Extracted 18 chapters

[2/5] üî™ Chunking text...
‚úÖ Created 243 chunks

[3/5] üß† Generating embeddings...
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 243/243 [02:15<00:00, 1.79it/s]

[4/5] üóÑÔ∏è  Setting up ChromaDB...

[5/5] üì§ Adding chunks to ChromaDB...
‚úÖ Added 243 chunks
```

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞

```bash
python src/bot/telegram_bot.py
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
üîß Initializing RAG system...
üì• Loading embedding model: paraphrase-multilingual-MiniLM-L12-v2
‚úÖ Model loaded
‚úÖ ChromaDB initialized
‚úÖ Bot initialized and ready!

üöÄ Starting Telegram bot...
‚úÖ Bot is running! Press Ctrl+C to stop.
```

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Telegram

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ `/start`
3. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä: "–ö–∞–∫ –º–Ω–µ –Ω–∞—á–∞—Ç—å –±–µ–≥–∞—Ç—å –ø–æ —É—Ç—Ä–∞–º?"

–ë–æ—Ç –±—É–¥–µ—Ç:
1. –ò—Å–∫–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç—Ä—ã–≤–∫–∏ –∏–∑ –∫–Ω–∏–≥–∏
2. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –≤ —Å—Ç–∏–ª–µ –î–∂–µ–π–º—Å–∞ –ö–ª–∏—Ä–∞
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∫–Ω–∏–≥–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ books/                          # EPUB –∫–Ω–∏–≥–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ –î–∂–µ–π–º—Å_–ö–ª–∏—Ä_–ê—Ç–æ–º–Ω—ã–µ_–ø—Ä–∏–≤—ã—á–∫–∏...epub
‚îÇ   ‚îî‚îÄ‚îÄ chroma_db/                      # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ rag/                            # RAG —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ epub_parser.py              # –ü–∞—Ä—Å–∏–Ω–≥ EPUB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chunker.py                  # –†–∞–∑–±–∏–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embedder.py                 # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ search.py                   # –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ai/                             # AI –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ deepseek_client.py          # DeepSeek API + RAG
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ bot/                            # Telegram –±–æ—Ç
‚îÇ       ‚îî‚îÄ‚îÄ telegram_bot.py             # –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ ingest_book.py                  # –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥–∏
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt                    # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example                        # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ SETUP_GUIDE.md                      # –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä EPUB:
```bash
python src/rag/epub_parser.py
```

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å chunker:
```bash
python src/rag/chunker.py
```

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å embedder:
```bash
python src/rag/embedder.py
```

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å DeepSeek –∫–ª–∏–µ–Ω—Ç:
```bash
python src/ai/deepseek_client.py
```

## üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### RAG Pipeline:

```
–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      ‚Üì
[1] –°–æ–∑–¥–∞–Ω–∏–µ embedding –≤–æ–ø—Ä–æ—Å–∞
      ‚Üì
[2] –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö chunks –≤ ChromaDB (top 3)
      ‚Üì
[3] –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞:
    System: "–¢—ã –î–∂–µ–π–º—Å –ö–ª–∏—Ä..."
    Context: [3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –æ—Ç—Ä—ã–≤–∫–∞ –∏–∑ –∫–Ω–∏–≥–∏]
    User: "–ö–∞–∫ –Ω–∞—á–∞—Ç—å –±–µ–≥–∞—Ç—å?"
      ‚Üì
[4] DeepSeek API –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
      ‚Üì
[5] –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ RAG:

‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å**: –û—Ç–≤–µ—Ç—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ –∫–Ω–∏–≥–∏
‚úÖ **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –æ—Ç—Ä—ã–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ù–µ –Ω—É–∂–Ω–æ –≤–µ—Å—å —Ç–µ–∫—Å—Ç –≤ –ø—Ä–æ–º–ø—Ç (—ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤)
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –∫–Ω–∏–≥–∏/–ª–∏—á–Ω–æ—Å—Ç–∏

## üîë –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

### DeepSeek API:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://platform.deepseek.com
2. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å (~$5 —Ö–≤–∞—Ç–∏—Ç –Ω–∞ –º–µ—Å—è—Ü—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
3. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á –≤ —Ä–∞–∑–¥–µ–ª–µ API Keys
4. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`

### Telegram Bot Token:
1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º (–∏–º—è, username)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω
5. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`

## üìä –°—Ç–æ–∏–º–æ—Å—Ç—å

**DeepSeek API** (–æ—á–µ–Ω—å –¥–µ—à–µ–≤–æ):
- Input: $0.14 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
- Output: $0.28 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
- –°—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å —Å RAG: ~3000 —Ç–æ–∫–µ–Ω–æ–≤ = **$0.0006**
- 1000 —Å–æ–æ–±—â–µ–Ω–∏–π ‚âà **$0.60**

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- ChromaDB: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (–ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î)
- Embeddings: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (–ª–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)

## üêõ Troubleshooting

### "ModuleNotFoundError: No module named 'ebooklib'"
```bash
pip install ebooklib
```

### "ChromaDB not found or empty!"
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞:
```bash
python scripts/ingest_book.py
```

### "DeepSeek API key not provided"
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
1. –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `.env`
2. –î–æ–±–∞–≤–ª–µ–Ω `DEEPSEEK_API_KEY=...`
3. –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –≤–æ–∫—Ä—É–≥ –∫–ª—é—á–∞

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings
–ù–æ—Ä–º–∞–ª—å–Ω–æ! sentence-transformers —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ CPU. –î–ª—è 243 chunks ~2-3 –º–∏–Ω—É—Ç—ã.
–≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–Ω–∏–≥–∏.

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ª–∏—á–Ω–æ—Å—Ç–µ–π**:
   - –°–∫–∞—á–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–Ω–∏–≥–∏
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã –≤ `deepseek_client.py`
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å `ingest_book.py` —Å –¥—Ä—É–≥–∏–º `collection_name`

2. **–£–ª—É—á—à–∏—Ç—å –±–æ—Ç–∞**:
   - –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ (inline keyboard)
   - –°–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–∏–∫–æ–≤ (–∫–∞–∫ –≤ Duolingo)
   - –¢—Ä–µ–∫–∏–Ω–≥ —Ü–µ–ª–µ–π –∏ –ø—Ä–∏–≤—ã—á–µ–∫

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ë–æ–ª–µ–µ —É–º–Ω—ã–π retrieval (re-ranking)
   - Hybrid search (keyword + semantic)

## üìû –ü–æ–º–æ—â—å

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API –∫–ª—é—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –∏—Å–ø–æ–ª—å–∑—É—è:**
- Python 3.10+
- ChromaDB –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- sentence-transformers –¥–ª—è embeddings
- DeepSeek –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
- python-telegram-bot –¥–ª—è Telegram –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
