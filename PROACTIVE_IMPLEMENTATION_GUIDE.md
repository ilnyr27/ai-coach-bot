# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–æ—Ç–∞

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç):

1. **SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** ‚úÖ
   - –°—Ö–µ–º–∞ —Å 7 —Ç–∞–±–ª–∏—Ü–∞–º–∏: users, goals, user_context, messages, scheduled_messages, important_dates, activity_log
   - DatabaseManager –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ boost mode, pause, –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–∞—Å—Ç–æ—Ç—ã

2. **–î–æ–±–∞–≤–ª–µ–Ω APScheduler** –≤ requirements.txt ‚úÖ

## üîß –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ–¥–µ–ª–∞—Ç—å (2-3 —á–∞—Å–∞):

### 1. Scheduler —Å–∏—Å—Ç–µ–º–∞ (60 –º–∏–Ω)
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª: `src/scheduler/proactive_scheduler.py`

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
```python
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from datetime import datetime, timedelta
import random

class ProactiveScheduler:
    def __init__(self, db_manager, bot, ai_client):
        self.db = db_manager
        self.bot = bot
        self.ai = ai_client
        self.scheduler = AsyncIOScheduler()

    def schedule_daily_messages(self, telegram_id):
        """–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –¥–µ–Ω—å"""
        user = self.db.get_user(telegram_id)
        target_count = user['messages_per_day']

        if user['boost_mode']:
            target_count *= 2  # Boost mode!

        # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        self.db.schedule_message(telegram_id, time(9, 0), 'morning')
        self.db.schedule_message(telegram_id, time(14, 0), 'midday')
        self.db.schedule_message(telegram_id, time(20, 0), 'evening')

        # –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É–º–Ω–æ
        # ... –ª–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

    async def send_pending_messages(self):
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        pending = self.db.get_pending_messages()

        for msg in pending:
            try:
                # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ AI
                text = await self.generate_proactive_message(
                    msg['telegram_id'],
                    msg['message_type'],
                    msg['context_data']
                )

                # –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                await self.bot.send_message(msg['telegram_id'], text)

                # –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ
                self.db.mark_message_sent(msg['id'])
            except Exception as e:
                self.db.mark_message_failed(msg['id'], str(e))
```

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (45 –º–∏–Ω)
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª: `src/ai/proactive_messages.py`

**–¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π:**
- **morning** - –£—Ç—Ä–µ–Ω–Ω–µ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- **midday** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **evening** - –í–µ—á–µ—Ä–Ω—è—è —Ä–µ—Ñ–ª–µ–∫—Å–∏—è
- **checkin** - –ü—Ä–æ—Å—Ç–æ–µ "–ö–∞–∫ –¥–µ–ª–∞?"
- **reminder** - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ü–µ–ª–∏
- **motivation** - –ú–æ—Ç–∏–≤–∞—Ü–∏—è
- **celebration** - –ü—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—Ö–∞

**–ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞:**
```python
PROACTIVE_PROMPTS = {
    'morning': """
    –¢—ã –î–∂–µ–π–º—Å –ö–ª–∏—Ä. –ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) —É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

    –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
    - –¶–µ–ª–∏: {goals}
    - –ù–µ–¥–∞–≤–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã: {struggles}

    –°—Ç–∏–ª—å:
    - –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –Ω–æ –Ω–µ –¥–∞–≤—è—â–∏–π
    - –°–ø—Ä–æ—Å–∏—Ç—å —á—Ç–æ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç —Å–µ–≥–æ–¥–Ω—è
    - –ù–∞–ø–æ–º–Ω–∏—Ç—å –ø—Ä–æ –ø—Ä–∞–≤–∏–ª–æ 2 –º–∏–Ω—É—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    """,

    'reminder': """
    –ù–∞–ø–æ–º–Ω–∏ –ø—Ä–æ —Ü–µ–ª—å "{goal}" –≤ —Å—Ç–∏–ª–µ –î–∂–µ–π–º—Å–∞ –ö–ª–∏—Ä–∞.
    –ö–æ—Ä–æ—Ç–∫–æ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è), –¥—Ä—É–∂–µ–ª—é–±–Ω–æ.
    –°–ø—Ä–æ—Å–∏ –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–ª–∏ —á—Ç–æ –º–µ—à–∞–µ—Ç.
    """,
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã
}
```

### 3. –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (45 –º–∏–Ω)
–î–æ–±–∞–≤–∏—Ç—å –≤ `src/bot/telegram_bot.py`:

```python
async def setup_command(self, update, context):
    """–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞"""
    keyboard = [
        [InlineKeyboardButton("üü¢ Low (5-10)", callback_data='freq_low')],
        [InlineKeyboardButton("üü° Medium (10-20)", callback_data='freq_medium')],
        [InlineKeyboardButton("üî¥ High (20-40)", callback_data='freq_high')]
    ]

    await update.message.reply_text(
        "–°–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∞—Ç—å?",
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def boost_command(self, update, context):
    """–í–∫–ª—é—á–∏—Ç—å boost mode"""
    telegram_id = update.effective_user.id
    self.db.enable_boost_mode(telegram_id, duration_hours=24)

    await update.message.reply_text(
        "üìà BOOST MODE –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 24 —á–∞—Å–∞!\n"
        "–ß–∞—Å—Ç–æ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —É–≤–µ–ª–∏—á–µ–Ω–∞ –≤ 2 —Ä–∞–∑–∞."
    )

async def pause_command(self, update, context):
    """–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è"""
    # –ü–æ–ª—É—á–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
    # /pause 3h –∏–ª–∏ /pause 2d
    # ...

async def goal_command(self, update, context):
    """–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ü–µ–ª—å"""
    goal_text = ' '.join(context.args)
    self.db.add_goal(update.effective_user.id, goal_text, priority='high')

    await update.message.reply_text(
        f"üéØ –¶–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞: \"{goal_text}\"\n"
        "–ë—É–¥—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å—Å!"
    )
```

### 4. Context tracking (30 –º–∏–Ω)
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª: `src/utils/context_extractor.py`

```python
def extract_goals_from_message(text: str) -> List[str]:
    """–ò–∑–≤–ª–µ—á—å —Ü–µ–ª–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ü–µ–ª–µ–π:
    # "—Ö–æ—á—É –Ω–∞—á–∞—Ç—å...", "–º–Ω–µ –Ω—É–∂–Ω–æ...", "–ø–ª–∞–Ω–∏—Ä—É—é...", etc.
    patterns = [
        r"—Ö–æ—á—É\s+(.+)",
        r"–ø–ª–∞–Ω–∏—Ä—É—é\s+(.+)",
        r"–Ω—É–∂–Ω–æ\s+(.+)",
        r"—Ü–µ–ª—å[\s:]+(.+)"
    ]

    # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DeepSeek –¥–ª—è —É–º–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    # prompt = f"–ò–∑–≤–ª–µ–∫–∏ —Ü–µ–ª–∏/–∑–∞–¥–∞—á–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞: {text}"
```

## üìù –ò—Ç–æ–≥–æ–≤—ã–π TODO:

1. [ ] –°–æ–∑–¥–∞—Ç—å `src/scheduler/proactive_scheduler.py` - —Å–∏—Å—Ç–µ–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
2. [ ] –°–æ–∑–¥–∞—Ç—å `src/ai/proactive_messages.py` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
3. [ ] –°–æ–∑–¥–∞—Ç—å `src/utils/context_extractor.py` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–ª–µ–π –∏–∑ –¥–∏–∞–ª–æ–≥–æ–≤
4. [ ] –û–±–Ω–æ–≤–∏—Ç—å `src/bot/telegram_bot.py` - –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å scheduler
5. [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–Ω–∏–≥—É –≤ RAG (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
python scripts/ingest_book.py

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python src/bot/telegram_bot.py
```

## üéØ –ö–∞–∫ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/start`
2. –ë–æ—Ç: "–ü—Ä–∏–≤–µ—Ç! –ù–∞—Å—Ç—Ä–æ–∏–º –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å?"
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –≤—ã–±–∏—Ä–∞–µ—Ç —á–∞—Å—Ç–æ—Ç—É (Low/Medium/High)
4. –ë–æ—Ç –ø–ª–∞–Ω–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –¥–µ–Ω—å
5. –í –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –±–æ—Ç –ø–∏—à–µ—Ç —Å–∞–º
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç `/boost` –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã
7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç `/pause 3h` –¥–ª—è –ø–∞—É–∑—ã
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç `/goal –ë–µ–≥–∞—Ç—å –ø–æ —É—Ç—Ä–∞–º` —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å:

–ü—Ä–∏ 20 —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å:
- **$0.33/–º–µ—Å—è—Ü** —Å DeepSeek
- –û—á–µ–Ω—å –¥–µ—à–µ–≤–æ!

---

**–•–æ—á–µ—à—å —á—Ç–æ–±—ã —è –ø—Ä–æ–¥–æ–ª–∂–∏–ª –∏ –¥–æ–¥–µ–ª–∞–ª –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ñ–∞–π–ª—ã?** –ò–ª–∏ –±—É–¥–µ—à—å —Å–∞–º –∑–∞–≤–µ—Ä—à–∞—Ç—å –ø–æ —ç—Ç–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏? üöÄ
